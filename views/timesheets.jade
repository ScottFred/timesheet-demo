extends layout

block content
    div(ng-controller='timesheetsCtrl')
        div
            div.main-activity.pull-right(ng-show='isLoading() || isSaving()')
                img(src='/images/ajax-loader.gif')
            h1 #{user ? user.username + "'s" : null} Timesheets
        table.table(ng-cloak)
            tbody
                tr.header(ng-repeat-start='timesheet in timesheets | orderBy: "sortableWeekEnding"')
                    th Week Ending
                    th(colspan='2') Project
                    th.text-center Sun
                    th.text-center Mon
                    th.text-center Tue
                    th.text-center Wed
                    th.text-center Thu
                    th.text-center Fri
                    th.text-center Sat
                    th.text-center Total
                tr.new-week
                    td.week-ending(rowspan='{{timesheet.projects.length + (isEditing(timesheet) ? 3 : 2)}}')
                        div(ng-hide='isEditing(timesheet)') {{timesheet.weekEnding}}
                        div(ng-show='isEditing(timesheet)')
                            input.form-control.input-sm(type='text', placeholder="MM/DD/YYYY", ng-model="timesheet.weekEnding", ng-datepicker)
                        div(ng-show='canEdit(timesheet)')
                            a(href='#', ng-click='edit(timesheet)') Edit
                        div(ng-show='isEditing(timesheet)')
                            a.edit-action(href='#', ng-click='save()') Save
                            a.edit-action(href='#', ng-click='cancel()') Cancel
                            a.edit-action(href='#', ng-really-message='Are you sure you want to delete this timesheet?' ng-really-click='delete()') Delete
                    td(ng-hide='isEditing(timesheet)', colspan='2') {{timesheet.projects[0].name}}
                    td.row-action(ng-show='isEditing(timesheet)')
                        a(href='#', title='Delete Row', ng-click='deleteProject(timesheet, timesheet.projects[0])')
                            span.glyphicon.glyphicon-minus-sign(aria-hidden='true')
                    td(ng-show='isEditing(timesheet)')
                        select.form-control.input-sm(placeholder="Project", ng-options='p.name as p.name for p in projects', ng-model='timesheet.projects[0].name')
                            option
                    td.hours(ng-hide='isEditing(timesheet)', ng-repeat='day in [0,1,2,3,4,5,6]')
                        p {{timesheet.projects[0].hours[day]}}
                    td.hours(ng-show='isEditing(timesheet)', ng-repeat='day in [0,1,2,3,4,5,6]')
                        input.form-control.input-sm(type='number', min='0', ng-model='timesheet.projects[0].hours[day]')
                    td.hours
                        p {{calcTotalHoursByProject(timesheet.projects[0])}}
                tr(ng-repeat='project in timesheet.projects.slice(1)')
                    td(ng-hide='isEditing(timesheet)', colspan='2') {{project.name}}
                    td.row-action(ng-show='isEditing(timesheet)')
                        a(href='#', title='Delete Row', ng-click='deleteProject(timesheet, project)')
                            span.glyphicon.glyphicon-minus-sign(aria-hidden='true')
                    td(ng-show='isEditing(timesheet)')
                        select.form-control.input-sm(ng-options='p.name as p.name for p in projects', ng-model='project.name')
                            option
                    td.hours(ng-hide='isEditing(timesheet)', ng-repeat='day in [0,1,2,3,4,5,6]')
                        p {{project.hours[day]}}
                    td.hours(ng-show='isEditing(timesheet)', ng-repeat='day in [0,1,2,3,4,5,6]')
                        input.form-control.input-sm(type='number', min='0', name='hours', ng-model='project.hours[day]')
                    td.hours
                        p {{calcTotalHoursByProject(project)}}
                tr(ng-show='isEditing(timesheet)')
                    td.row-action
                        a(href='#', title='Add Row', ng-click='addProject(timesheet)')
                            span.glyphicon.glyphicon-plus-sign(aria-hidden='true')
                    td(colspan='9')
                tr
                    td(colspan='2') Total
                    td.hours(ng-repeat='day in [0,1,2,3,4,5,6]')
                        p {{calcTotalHoursByDay(timesheet, day)}}
                    td.hours
                        p {{calcTotalHours(timesheet)}}
                tr(ng-repeat-end)
                    td(colspan='10') &nbsp;
                tr
                    td.new-week(colspan='11')
                        a(href='#', ng-show='canAdd()', ng-click='add()') Add Week

block scripts
    script(src='/javascripts/controllers/timesheets.js')
    script(src='/javascripts/directives/ng-datepicker.js')
    script(src='/javascripts/directives/ng-really.js')